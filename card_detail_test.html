<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卡片详情弹窗布局测试</title>
    <link rel="stylesheet" href="tailwind.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        }
        
        /* 测试按钮 */
        .test-btn {
            background: white;
            color: #667eea;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin: 20px auto;
            display: block;
        }
        
        .test-btn:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="text-center mb-8">
        <h1 class="text-white text-2xl font-bold mb-4">卡片详情弹窗布局测试</h1>
        <button class="test-btn" onclick="showCardDetail()">点击测试卡片详情弹窗</button>
    </div>

    <script>
        // 从app.js复制Markdown解析器
        class MarkdownParser {
            static parseMarkdown(text) {
                if (!text) return '';
                
                let html = text
                    // 处理分隔线
                    .replace(/^---+$/gm, '<hr class="my-4 border-gray-300 border-opacity-50">')
                    
                    // 处理标题（###, ##, #）
                    .replace(/^### (.*$)/gm, '<h3 class="text-lg font-semibold text-gray-800 mt-4 mb-2">$1</h3>')
                    .replace(/^## (.*$)/gm, '<h2 class="text-xl font-semibold text-gray-800 mt-5 mb-3">$1</h2>')
                    .replace(/^# (.*$)/gm, '<h1 class="text-2xl font-bold text-gray-800 mt-6 mb-4">$1</h1>')
                    
                    // 处理粗体
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-gray-800">$1</strong>')
                    
                    // 处理斜体
                    .replace(/\*(.*?)\*/g, '<em class="italic text-gray-700">$1</em>')
                    
                    // 处理表情符号开头的段落（特殊格式）
                    .replace(/^(🌱|🧠|🌸|🌼|💡|⚡|🎯|💭|✨|🔍|📝|💪|🌟|🎪|🎨|📊|🏆)\s+(.*$)/gm, '<div class="flex items-start mb-3"><span class="text-lg mr-2 mt-1">$1</span><div class="flex-1">$2</div></div>')
                    
                    // 处理有序列表
                    .replace(/^\d+\.\s+(.*$)/gm, '<li class="mb-2 ml-4">$1</li>')
                    
                    // 处理无序列表
                    .replace(/^[-\*]\s+(.*$)/gm, '<li class="mb-2 ml-4 relative"><span class="absolute -left-4 text-blue-500">•</span>$1</li>')
                    
                    // 处理行内代码
                    .replace(/`([^`]+)`/g, '<code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">$1</code>')
                    
                    // 处理换行
                    .replace(/\n\n/g, '</p><p class="mb-3">')
                    .replace(/\n/g, '<br>');
                
                // 包装列表项
                html = html.replace(/(<li.*?<\/li>)/gs, function(match, listItems) {
                    if (listItems.includes('ml-4')) {
                        return `<ul class="list-none mb-4">${listItems}</ul>`;
                    }
                    return match;
                });
                
                // 包装段落
                if (!html.includes('<h1>') && !html.includes('<h2>') && !html.includes('<h3>') && !html.includes('<div class="flex')) {
                    html = '<p class="mb-3">' + html + '</p>';
                } else {
                    // 对于包含标题的内容，只在非标题段落加p标签
                    html = html.replace(/^(?!<[h123]|<div|<ul|<hr|<li)(.+)$/gm, '<p class="mb-3">$1</p>');
                }
                
                return html;
            }
            
            static enhanceReflectionContent(text) {
                // 专门为复盘内容优化的解析
                let html = this.parseMarkdown(text);
                
                // 增强样式处理
                html = html
                    // 为行动计划添加特殊样式
                    .replace(/<li([^>]*?)>(.*?(?:行动|建议|计划|目标|步骤).*?)<\/li>/gi, 
                        '<li$1><div class="action-item">$2</div></li>')
                    
                    // 为洞察内容添加高亮
                    .replace(/<p([^>]*?)>(.*?(?:洞察|领悟|发现|意识到).*?)<\/p>/gi, 
                        '<div class="highlight">$2</div>')
                    
                    // 美化表情符号段落
                    .replace(/<div class="flex items-start mb-3"><span class="text-lg mr-2 mt-1">(🌱|🧠|🌸|🌼)<\/span><div class="flex-1">(.*?)<\/div><\/div>/g,
                        '<div class="flex items-start mb-4 p-3 bg-white bg-opacity-40 rounded-lg"><span class="text-2xl mr-3">$1</span><div class="flex-1 font-medium">$2</div></div>');
                
                return html;
            }
        }

        function showCardDetail() {
            // 测试数据
            const card = {
                title: "**深度复盘卡片：在忙碌中找回节奏，温柔对待自己**",
                content: `**深度复盘卡片：从生活情绪中挖掘创意灵感**

### 🌱 深度洞察
最好的产品创意往往源于真实的生活体验与情感反应，尤其是那些让人感到不便、惊喜或触动的瞬间。

### 🧠 关键点
1. **关注生活中的"情绪时刻"**——无聊、沮丧、惊喜，都是创意的线索。
2. 从自己或他人的痛点出发，更容易找到真实的需求。
3. 与身边人交流，收集他们的烦恼与期待，能激发新的视角。

### 🌼 行动建议
- 回忆最近一周让你有情绪波动的小事，写下当时的感受与可能的改进想法。
- 和朋友聊聊他们的日常困扰，试着从中发现可以解决的小问题。

**愿你从生活的细节中，找到改变世界的灵感！✨**`,
                tags: ['沟通', '决策'],
                type: 'quick',
                createdAt: new Date().toISOString()
            };
            
            const cardColor = 'orange';
            
            // 创建模态框
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            // 清理卡片标题中的Markdown符号
            const cleanTitle = card.title.replace(/\*\*(.*?)\*\*/g, '$1').replace(/\*(.*?)\*/g, '$1').replace(/#+\s*/, '');
            
            modal.innerHTML = `
                <div class="w-[700px] max-w-90vw max-h-[85vh] relative">
                    <!-- 与对话部分完全一致的复盘卡片结构 -->
                    <div class="macaron-card ${cardColor} mb-4">
                        <div class="macaron-title">${cleanTitle}</div>
                        
                        <!-- 卡片元信息 -->
                        <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-xl p-4 mb-4">
                            <div class="flex flex-wrap gap-2 items-center justify-between">
                                <div class="flex flex-wrap gap-2">
                                    ${card.tags.map(tag => `
                                        <span class="macaron-tag ${cardColor}">#${tag}</span>
                                    `).join('')}
                                    <span class="macaron-tag ${card.type === 'deep' ? 'purple' : 'orange'}">
                                        ${card.type === 'deep' ? '🧠 深潜' : '⚡ 闪电'}复盘
                                    </span>
                                </div>
                                <span class="text-sm text-white font-medium">${new Date(card.createdAt).toLocaleDateString('zh-CN', { 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric',
                                    weekday: 'long'
                                })}</span>
                            </div>
                        </div>
                        
                        <div class="reflection-card-content">
                            <div class="reflection-content">${MarkdownParser.enhanceReflectionContent(card.content)}</div>
                            
                            <!-- 关闭按钮放在内容右下方 -->
                            <div class="flex justify-end mt-6">
                                <button class="close-card-detail py-3 px-8 bg-white bg-opacity-90 text-gray-700 rounded-full hover:bg-white hover:shadow-lg transition-all font-medium">
                                    关闭
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 添加动画效果
            setTimeout(() => {
                modal.querySelector('.macaron-card').classList.add('modal-enter');
            }, 10);
            
            // 关闭按钮
            modal.querySelector('.close-card-detail').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // 点击外部关闭
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
    </script>
</body>
</html>