# 🚀 安全防护部署指南

## 快速部署

### 1. 检查更新的文件

确保以下文件已更新：
- ✅ `app.js` - 主要安全逻辑实现
- ✅ `security_test.html` - 安全测试页面
- ✅ `SECURITY_GUIDE.md` - 详细安全文档

### 2. 验证功能正常

1. 启动应用服务器：
   ```bash
   npm start
   # 或
   node proxy_server.js
   ```

2. 访问主应用：`http://localhost:3001`

3. 进行基础功能测试：
   - 创建新的AI圆桌对话
   - 发送正常消息验证功能
   - 尝试进行复盘功能

### 3. 安全测试验证

1. 访问安全测试页面：`http://localhost:3001/security_test.html`

2. 运行所有测试用例，确认：
   - ⛔ 攻击性输入被正确拦截
   - ✅ 正常输入可以通过
   - 📝 安全日志正确记录

### 4. 生产环境部署

在生产环境中，建议：

1. **监控设置**：
   ```javascript
   // 在控制台监控安全事件
   console.warn('检测到潜在攻击'); // 这些日志应被收集
   ```

2. **性能监控**：
   - 监控安全检查的延迟
   - 关注内存使用情况

3. **用户反馈**：
   - 收集误报情况
   - 优化检测规则

## 🔧 配置调优

### 安全级别调整

根据应用场景调整安全严格程度：

```javascript
// 在 detectPromptInjection() 方法中
const specialCharRatio = 0.3;  // 调整为 0.2-0.4
const maxInputLength = 2000;   // 调整为 1000-5000
```

### 日志级别

```javascript
// 生产环境可调整为 error 级别
console.warn() → console.error()
```

## 📋 验收检查清单

- [ ] 所有恶意输入测试用例被拦截
- [ ] 正常对话功能不受影响
- [ ] 复盘功能安全防护生效
- [ ] 系统指令不会被泄露
- [ ] 错误提示用户友好
- [ ] 性能影响在可接受范围内
- [ ] 安全日志正确记录

## 🚨 紧急响应

如果发现新的安全漏洞：

1. **立即应对**：
   - 临时关闭受影响的功能
   - 收集攻击样本和日志

2. **分析修复**：
   - 分析攻击方式
   - 更新检测规则
   - 进行充分测试

3. **部署更新**：
   - 推送安全更新
   - 通知相关人员
   - 监控效果

---

*部署完成后，建议阅读完整的 `SECURITY_GUIDE.md` 了解详细的安全机制。*