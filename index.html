<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåœ†æ¡Œ Â· æˆé•¿å¯¹è¯</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <!-- ä½¿ç”¨æœ¬åœ°Tailwind CSSæ–‡ä»¶ï¼Œå¦‚æœåŠ è½½å¤±è´¥åˆ™å›é€€åˆ°CDN -->
    <link rel="stylesheet" href="tailwind.min.css" onerror="this.onerror=null;this.href='https://cdn.tailwindcss.com';">
    
    <!-- åˆ†äº«é•¿å›¾åŠŸèƒ½æ‰€éœ€çš„å¤–éƒ¨åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
    <script>
        // å®‰å…¨é…ç½® Tailwind CSS
        function configureTailwind() {
            if (typeof tailwind !== 'undefined' && tailwind.config) {
                try {
                    tailwind.config = {
                        theme: {
                            extend: {
                                colors: {
                                    'warm-blue': '#5A7CA8',
                                    'morning-orange': '#FF9A4D',
                                    'light-cream': '#FEFCF7'
                                }
                            }
                        }
                    };
                    console.log('Tailwind é…ç½®å·²æˆåŠŸåº”ç”¨');
                } catch (error) {
                    console.warn('Tailwind é…ç½®å¤±è´¥:', error);
                }
            }
        }

        // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            try {
                const response = await fetch('/api/auth/me', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    // ç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
                    window.location.href = 'login.html';
                    return false;
                }
                
                const data = await response.json();
                console.log('ç”¨æˆ·å·²ç™»å½•:', data.user.username);
                return true;
            } catch (error) {
                console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€æ—¶å‡ºé”™:', error);
                // å‡ºé”™æ—¶ä¹Ÿé‡å®šå‘åˆ°ç™»å½•é¡µé¢
                window.location.href = 'login.html';
                return false;
            }
        }

        // æ£€æŸ¥æ˜¯å¦éœ€è¦åŠ è½½Tailwind CDN
        document.addEventListener('DOMContentLoaded', async function() {
            // é¦–å…ˆæ£€æŸ¥ç™»å½•çŠ¶æ€
            const isLoggedIn = await checkLoginStatus();
            if (!isLoggedIn) {
                return; // å¦‚æœæœªç™»å½•ï¼Œä¼šé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œä¸éœ€è¦ç»§ç»­æ‰§è¡Œ
            }
            
            // å…ˆå°è¯•é…ç½®æœ¬åœ° Tailwind
            configureTailwind();
            
            // æ£€æŸ¥æ ·å¼æ˜¯å¦ç”Ÿæ•ˆ
            setTimeout(function() {
                const style = getComputedStyle(document.body);
                if (style.backgroundColor !== 'rgb(254, 252, 247)') { // æ£€æŸ¥light-creamèƒŒæ™¯è‰²æ˜¯å¦ç”Ÿæ•ˆ
                    const script = document.createElement('script');
                    script.src = 'https://cdn.tailwindcss.com';
                    script.onload = function() {
                        // Tailwind CDN åŠ è½½å®Œæˆåé…ç½®
                        setTimeout(configureTailwind, 100);
                    };
                    document.head.appendChild(script);
                    console.log('å·²åŠ è½½Tailwind CDNä½œä¸ºå¤‡ç”¨');
                }
            }, 100);
        });

        // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            try {
                const response = await fetch('/api/auth/me', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    // ç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
                    window.location.href = 'login.html';
                    return false;
                }
                
                const data = await response.json();
                console.log('ç”¨æˆ·å·²ç™»å½•:', data.user.username);
                return true;
            } catch (error) {
                console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€æ—¶å‡ºé”™:', error);
                // å‡ºé”™æ—¶ä¹Ÿé‡å®šå‘åˆ°ç™»å½•é¡µé¢
                window.location.href = 'login.html';
                return false;
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light-cream font-sans">
    <!-- æ£€æŸ¥ç™»å½•çŠ¶æ€çš„è„šæœ¬ -->
    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        document.addEventListener('DOMContentLoaded', function() {
            // checkAuthStatus å‡½æ•°å·²ç»åœ¨ä¸Šé¢çš„ checkLoginStatus ä¸­å¤„ç†äº†
            // è¿™é‡Œåªéœ€è¦å¤„ç†ç®¡ç†å‘˜æŒ‰é’®çš„æ˜¾ç¤º
            setTimeout(checkAdminButton, 500); // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿ç”¨æˆ·ä¿¡æ¯å·²åŠ è½½
        });
        
        // æ£€æŸ¥å¹¶æ˜¾ç¤ºç®¡ç†å‘˜æŒ‰é’®
        async function checkAdminButton() {
            if (window.currentUser && window.currentUser.role === 'admin') {
                const bottomMenu = document.querySelector('.border-t.border-gray-100.space-y-2');
                if (bottomMenu) {
                    const adminBtn = document.createElement('button');
                    adminBtn.id = 'adminBtn';
                    adminBtn.className = 'w-full text-left px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors';
                    adminBtn.innerHTML = 'ğŸ‘‘ ç®¡ç†åå°';
                    adminBtn.onclick = function() {
                        window.location.href = 'admin.html';
                    };
                    bottomMenu.insertBefore(adminBtn, bottomMenu.firstChild);
                }
            }
        }
        
        // æ›´æ–° checkLoginStatus å‡½æ•°ä»¥è®¾ç½®å…¨å±€ç”¨æˆ·ä¿¡æ¯
        async function checkLoginStatus() {
            try {
                const response = await fetch('/api/auth/me', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    // ç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
                    window.location.href = 'login.html';
                    return false;
                }
                
                const data = await response.json();
                window.currentUser = data.user; // è®¾ç½®å…¨å±€ç”¨æˆ·ä¿¡æ¯
                console.log('ç”¨æˆ·å·²ç™»å½•:', data.user.username);
                return true;
            } catch (error) {
                console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€æ—¶å‡ºé”™:', error);
                // å‡ºé”™æ—¶ä¹Ÿé‡å®šå‘åˆ°ç™»å½•é¡µé¢
                window.location.href = 'login.html';
                return false;
            }
        }
    </script>
    <div id="app" class="flex h-screen">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <div class="w-80 bg-white border-r border-gray-200 flex flex-col">
            <!-- æœç´¢æ¡† -->
            <div class="p-4 border-b border-gray-100">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢èŠå¤©è®°å½•..." 
                           class="w-full px-4 py-2 bg-gray-50 rounded-lg border-none outline-none focus:bg-white focus:ring-2 focus:ring-warm-blue/20">
                </div>
            </div>

            <!-- æ–°å»ºåœ†æ¡ŒæŒ‰é’® -->
            <div class="p-4 border-b border-gray-100">
                <button id="newRoundtableBtn" class="w-full bg-morning-orange text-white py-2 px-4 rounded-lg hover:bg-orange-500 transition-colors duration-300">
                    + æ–°å»ºAIåœ†æ¡Œ
                </button>
            </div>

            <!-- ä¼šè¯åˆ—è¡¨ -->
            <div class="flex-1 overflow-y-auto">
                <div id="sessionList" class="p-2">
                    <!-- ä¼šè¯é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- åº•éƒ¨åŠŸèƒ½åŒº -->
            <div class="p-4 border-t border-gray-100 space-y-2">
                <button id="profileBtn" class="w-full text-left px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors">
                    ğŸ‘¤ ä¸ªäººä¸­å¿ƒ
                </button>
                <button id="configBtn" class="w-full text-left px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors">
                    âš™ï¸ é…ç½®ä¸­å¿ƒ
                </button>
                <button id="growthLogBtn" class="w-full text-left px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors">
                    ğŸ““ æˆé•¿æ—¥å¿—
                </button>
                <button id="logoutBtn" class="w-full text-left px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors">
                    ğŸšª é€€å‡ºç™»å½•
                </button>
            </div>
        </div>

        <!-- ä¸»èŠå¤©åŒºåŸŸ -->
        <div class="flex-1 flex flex-col">
            <!-- AIè§’è‰²æ  -->
            <div id="aiRoleBar" class="bg-white border-b border-gray-200 p-4">
                <div class="flex space-x-4" id="aiRoles">
                    <!-- AIè§’è‰²å¤´åƒå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- èŠå¤©æ¶ˆæ¯åŒº -->
            <div class="flex-1 overflow-y-auto p-6" id="chatMessages">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center text-gray-500 py-20">
                        <div class="text-6xl mb-4">ğŸ’¬</div>
                        <h2 class="text-2xl font-medium mb-2">æ¬¢è¿æ¥åˆ°AIåœ†æ¡Œ</h2>
                        <p class="text-gray-400">ç‚¹å‡»"æ–°å»ºAIåœ†æ¡Œ"å¼€å§‹æ‚¨çš„æˆé•¿å¯¹è¯</p>
                    </div>
                </div>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="bg-white border-t border-gray-200 p-4" id="inputArea">
                <div class="max-w-4xl mx-auto">
                    <div class="flex space-x-4 mb-3">
                        <input type="text" id="messageInput" placeholder="è¾“å…¥ä½ çš„æƒ³æ³•..." 
                               class="flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-warm-blue/20">
                        <button id="sendBtn" class="bg-warm-blue text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                            å‘é€
                        </button>
                    </div>
                    
                    <!-- å¤ç›˜æŒ‰é’®åŒºåŸŸ -->
                    <div class="flex justify-center">
                        <div class="inline-flex rounded-md shadow-sm" role="group">
                            <button id="quickReflectBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10">
                                âš¡ é—ªç”µå¤ç›˜
                            </button>
                            <button id="deepReflectBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-r-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10">
                                ğŸ§  æ·±æ½œå¤ç›˜
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å»ºåœ†æ¡Œæ¨¡æ€æ¡† -->
    <div id="newRoundtableModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-96 max-w-90vw">
            <h3 class="text-xl font-medium mb-4">é€‰æ‹©AIä¼™ä¼´</h3>
            <div class="space-y-3 mb-6">
                <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="aiRole" value="coach" class="text-warm-blue">
                    <div class="flex-1">
                        <div class="font-medium">ğŸ’¡ Coach å°æŸ¯</div>
                        <div class="text-sm text-gray-500">æˆé•¿å¼•å¯¼è€… - æ¸©å’Œæé—®å¼</div>
                    </div>
                </label>
                <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="aiRole" value="strategist" class="text-warm-blue">
                    <div class="flex-1">
                        <div class="font-medium">ğŸ§  Strategist è€è°‹</div>
                        <div class="text-sm text-gray-500">æˆ˜ç•¥é¡¾é—® - ç†æ€§æ¡†æ¶æ¸…æ™°</div>
                    </div>
                </label>
                <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="aiRole" value="psychologist" class="text-warm-blue">
                    <div class="flex-1">
                        <div class="font-medium">ğŸ’– Psychologist å¿ƒç†å§</div>
                        <div class="text-sm text-gray-500">æƒ…ç»ªä¼™ä¼´ - å…±æƒ…ç»†è…»</div>
                    </div>
                </label>
                <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="aiRole" value="operator" class="text-warm-blue">
                    <div class="flex-1">
                        <div class="font-medium">âš¡ Operator é˜¿æ“</div>
                        <div class="text-sm text-gray-500">è½åœ°ä¸“å®¶ - ç›´æ¥é«˜æ•ˆ</div>
                    </div>
                </label>
            </div>
            <div class="flex space-x-3">
                <button id="cancelRoundtable" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    å–æ¶ˆ
                </button>
                <button id="createRoundtable" class="flex-1 py-2 px-4 bg-warm-blue text-white rounded-lg hover:bg-blue-600">
                    åˆ›å»ºåœ†æ¡Œ
                </button>
            </div>
        </div>
    </div>

    <!-- é…ç½®ä¸­å¿ƒæ¨¡æ€æ¡† -->
    <div id="configModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-[500px] max-w-90vw max-h-[80vh] overflow-y-auto">
            <h3 class="text-xl font-medium mb-4">é…ç½®ä¸­å¿ƒ</h3>
            
            <!-- AIå¹³å°é€‰æ‹© -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">AIå¹³å°</label>
                <select id="aiProvider" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    <option value="dashscope">é˜¿é‡Œäº‘ç™¾ç‚¼</option>
                    <option value="openrouter">OpenRouter</option>
                </select>
            </div>

            <!-- API Keyé…ç½® -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">API Key</label>
                <input type="password" id="apiKey" placeholder="è¾“å…¥æ‚¨çš„API Key" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                <div class="text-xs text-gray-500 mt-1">ğŸ”’ ä»…æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</div>
            </div>

            <!-- æ¨¡å‹é€‰æ‹© -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">æ–‡æœ¬æ¨¡å‹</label>
                <select id="textModel" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    <option value="qwen-plus">qwen-plus</option>
                    <option value="qwen-max">qwen-max</option>
                    <option value="qwen-turbo">qwen-turbo</option>
                </select>
            </div>

            <!-- Google CSEé…ç½® -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Google CSE ID (å¯é€‰)</label>
                <input type="text" id="googleCseId" placeholder="ç”¨äºæœç´¢åŠŸèƒ½" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg">
            </div>

            <!-- å…¶ä»–è®¾ç½® -->
            <div class="mb-6">
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="enableAnimations" checked class="text-warm-blue">
                    <span class="text-sm">å¯ç”¨åŠ¨ç”»æ•ˆæœ</span>
                </label>
            </div>

            <div class="flex space-x-3">
                <button id="cancelConfig" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    å–æ¶ˆ
                </button>
                <button id="saveConfig" class="flex-1 py-2 px-4 bg-warm-blue text-white rounded-lg hover:bg-blue-600">
                    ä¿å­˜é…ç½®
                </button>
            </div>
        </div>
    </div>

    <!-- å¤ç›˜å¡ç‰‡æ¨¡æ€æ¡† -->
    <div id="reflectModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-[600px] max-w-90vw">
            <h3 class="text-xl font-medium mb-4" id="reflectModalTitle">åˆ›å»ºå¤ç›˜å¡ç‰‡</h3>
            
            <!-- é—ªç”µå¤ç›˜å†…å®¹ -->
            <div id="quickReflectContent">
                <p class="text-gray-600 mb-4">AIå°†æ ¹æ®å½“å‰å¯¹è¯è‡ªåŠ¨ç”Ÿæˆå¤ç›˜å¡ç‰‡</p>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">é€‰æ‹©æ ‡ç­¾</label>
                    <div class="flex flex-wrap gap-2">
                        <label class="inline-flex items-center px-3 py-1 rounded-full cursor-pointer macaron-tag pink">
                            <input type="checkbox" name="reflectTag" value="æ²Ÿé€š" class="mr-2">
                            #æ²Ÿé€š
                        </label>
                        <label class="inline-flex items-center px-3 py-1 rounded-full cursor-pointer macaron-tag purple">
                            <input type="checkbox" name="reflectTag" value="æƒ…ç»ª" class="mr-2">
                            #æƒ…ç»ª
                        </label>
                        <label class="inline-flex items-center px-3 py-1 rounded-full cursor-pointer macaron-tag green">
                            <input type="checkbox" name="reflectTag" value="å†³ç­–" class="mr-2">
                            #å†³ç­–
                        </label>
                        <label class="inline-flex items-center px-3 py-1 rounded-full cursor-pointer macaron-tag blue">
                            <input type="checkbox" name="reflectTag" value="èŒåœº" class="mr-2">
                            #èŒåœº
                        </label>
                        <label class="inline-flex items-center px-3 py-1 rounded-full cursor-pointer macaron-tag orange">
                            <input type="checkbox" name="reflectTag" value="æˆé•¿" class="mr-2">
                            #æˆé•¿
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- æ·±æ½œå¤ç›˜å†…å®¹ -->
            <div id="deepReflectContent" style="display: none;">
                <p class="text-gray-600 mb-4">AIå°†å¼•å¯¼æ‚¨è¿›è¡Œæ·±åº¦å¤ç›˜ï¼Œå¸®åŠ©æ‚¨è·å¾—æ›´æ·±åˆ»çš„æ´å¯Ÿ</p>
                
                <!-- å•ä¸ªé—®é¢˜å®¹å™¨ -->
                <div id="deepReflectQuestion" class="reflect-question">
                    <p class="reflect-question-text">AIæ­£åœ¨å‡†å¤‡å¼•å¯¼é—®é¢˜...</p>
                    <textarea id="deepReflectAnswer" class="reflect-answer-input" rows="3" placeholder="åœ¨è¿™é‡Œå›ç­”..."></textarea>
                </div>
                
                <!-- å¯¼èˆªæŒ‰é’® -->
                <div class="reflect-nav-buttons">
                    <button id="prevQuestion" class="reflect-nav-button prev" disabled>ä¸Šä¸€é¢˜</button>
                    <div id="questionProgress" class="text-sm text-gray-500">é—®é¢˜ 1/3</div>
                    <button id="nextQuestion" class="reflect-nav-button next">ä¸‹ä¸€é¢˜</button>
                </div>
            </div>
            
            <!-- å¤ç›˜ç»“æœ -->
            <div id="reflectResult" class="macaron-card blue mb-4" style="display: none;">
                <div class="reflection-card-content">
                    <!-- å¤ç›˜ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button id="cancelReflect" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50">
                    å–æ¶ˆ
                </button>
                <button id="createReflectCard" class="flex-1 py-2 px-4 bg-morning-orange text-white rounded-lg hover:bg-orange-500">
                    ç”Ÿæˆå¤ç›˜å¡ç‰‡
                </button>
            </div>
        </div>
    </div>

    <!-- æˆé•¿æ—¥å¿—æ¨¡æ€æ¡† -->
    <div id="growthLogModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-[800px] max-w-90vw max-h-[80vh] overflow-y-auto growth-log-macaron">
            <h3 class="text-xl font-medium mb-6 text-center">ğŸ““ æˆ‘çš„æˆé•¿æ—¥å¿—</h3>
            
            <!-- å¯¼èˆªæ ‡ç­¾ -->
            <div class="flex justify-center mb-6">
                <div class="inline-flex bg-gray-100 p-1 rounded-full">
                    <button class="growth-tab-macaron active px-4 py-2 rounded-full" data-target="growthTree">ğŸŒ± æˆé•¿æ ‘</button>
                    <button class="growth-tab-macaron px-4 py-2 rounded-full" data-target="cardArchive">ğŸ“Œ å¡ç‰‡æ¡£æ¡ˆ</button>
                    <button class="growth-tab-macaron px-4 py-2 rounded-full" data-target="growthDashboard">ğŸ“Š æˆé•¿ä»ªè¡¨ç›˜</button>
                    <button class="growth-tab-macaron px-4 py-2 rounded-full" data-target="monthlyReport">ğŸ“„ æœˆåº¦æŠ¥å‘Š</button>
                </div>
            </div>
            
            <!-- æˆé•¿æ ‘åŒºåŸŸ -->
            <div id="growthTreeTab" class="growth-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="growth-tree-container">
                        <div class="text-center">
                            <div id="growthTree" class="text-8xl mb-4 growth-tree-animate">ğŸŒ±</div>
                            <div class="text-lg font-medium text-gray-700">æˆé•¿æ ‘ Level 1</div>
                            <div class="text-sm text-gray-600 mb-4">å¹¼è‹—æœŸ</div>
                            
                            <!-- å­£èŠ‚æŒ‡ç¤ºå™¨ -->
                            <div class="flex justify-center items-center mb-4">
                                <span class="px-3 py-1 bg-white bg-opacity-50 rounded-full text-sm">
                                    <span id="currentSeason" class="mr-2">ğŸŒ±</span>
                                    <span id="seasonName">æ˜¥å¤©</span>
                                </span>
                            </div>
                            
                            <!-- å›¾ç‰‡ç”ŸæˆæŒ‰é’® -->
                            <div class="mt-3 mb-4">
                                <button id="generateTreeImageBtn" class="generate-image-btn flex items-center mx-auto">
                                    <span class="icon">ğŸ–¼ï¸</span>
                                    <span>ç”Ÿæˆæ ‘æœ¨å›¾ç‰‡</span>
                                </button>
                                <div id="imageGenerationStatus" class="text-xs text-gray-500 mt-2 text-center hidden">
                                    <span class="loading-dots">å›¾ç‰‡ç”Ÿæˆä¸­</span>
                                </div>
                            </div>
                            
                            <!-- æ ‘æœ¨ç±»å‹é€‰æ‹© -->
                            <div class="mt-4">
                                <label class="block text-sm font-medium mb-3 text-gray-700">é€‰æ‹©ä½ çš„æˆé•¿æ ‘ç±»å‹</label>
                                <div class="flex justify-center space-x-6">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="treeType" value="oak" class="hidden" checked>
                                        <div class="text-3xl p-3 rounded-full bg-white shadow-md hover:shadow-lg transition-all">ğŸŒ³</div>
                                        <div class="text-xs mt-2 text-gray-700">æ©¡æ ‘</div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="treeType" value="cherry" class="hidden">
                                        <div class="text-3xl p-3 rounded-full bg-white shadow-md hover:shadow-lg transition-all">ğŸŒ¸</div>
                                        <div class="text-xs mt-2 text-gray-700">æ¨±èŠ±</div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="treeType" value="bamboo" class="hidden">
                                        <div class="text-3xl p-3 rounded-full bg-white shadow-md hover:shadow-lg transition-all">ğŸ‹</div>
                                        <div class="text-xs mt-2 text-gray-700">ç«¹å­</div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-4 text-gray-700">æˆ‘çš„æˆé•¿ç»Ÿè®¡</h4>
                        <div class="growth-stats-container mb-5">
                            <div class="growth-stat-card">
                                <div class="growth-stat-value text-blue-500">0</div>
                                <div class="growth-stat-label">å¯¹è¯æ¬¡æ•°</div>
                            </div>
                            <div class="growth-stat-card">
                                <div class="growth-stat-value text-orange-500">0</div>
                                <div class="growth-stat-label">å¤ç›˜å¡ç‰‡</div>
                            </div>
                            <div class="growth-stat-card">
                                <div class="growth-stat-value text-green-500">0</div>
                                <div class="growth-stat-label">è¡ŒåŠ¨å®Œæˆ</div>
                            </div>
                            <div class="growth-stat-card">
                                <div class="growth-stat-value text-purple-500">0</div>
                                <div class="growth-stat-label">èŠ±æœµæ•°é‡</div>
                            </div>
                        </div>
                        
                        <div class="macaron-card purple">
                            <h5 class="macaron-title">æˆ‘çš„æˆå°±</h5>
                            <div id="achievements" class="text-center text-gray-500 py-2">
                                æš‚æ— æˆå°±ï¼Œç»§ç»­åŠªåŠ›ï¼
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å¡ç‰‡æ¡£æ¡ˆåŒºåŸŸ -->
            <div id="cardArchiveTab" class="growth-content hidden">
                <div class="mb-5 flex justify-between items-center">
                    <h4 class="font-medium text-gray-700">æˆ‘çš„å¤ç›˜å¡ç‰‡æ¡£æ¡ˆé¦†</h4>
                    <div class="flex space-x-2">
                        <select id="cardTimeFilter" class="text-sm border border-gray-200 rounded-full px-3 py-1 bg-white shadow-sm">
                            <option value="all">å…¨éƒ¨æ—¶é—´</option>
                            <option value="day">ä»Šå¤©</option>
                            <option value="week">æœ¬å‘¨</option>
                            <option value="month">æœ¬æœˆ</option>
                        </select>
                        <select id="cardTagFilter" class="text-sm border border-gray-200 rounded-full px-3 py-1 bg-white shadow-sm">
                            <option value="all">å…¨éƒ¨æ ‡ç­¾</option>
                            <option value="æ²Ÿé€š">#æ²Ÿé€š</option>
                            <option value="æƒ…ç»ª">#æƒ…ç»ª</option>
                            <option value="å†³ç­–">#å†³ç­–</option>
                            <option value="èŒåœº">#èŒåœº</option>
                            <option value="æˆé•¿">#æˆé•¿</option>
                        </select>
                    </div>
                </div>
                
                <div id="cardArchive" class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="text-center text-gray-500 py-10 col-span-2 bg-white rounded-lg shadow-sm">
                        <div class="text-4xl mb-3">ğŸ“Œ</div>
                        <div class="text-lg mb-1">æš‚æ— å¤ç›˜å¡ç‰‡</div>
                        <div class="text-sm text-gray-400">å¼€å§‹å¯¹è¯å¹¶è¿›è¡Œå¤ç›˜ï¼Œå¡ç‰‡å°†è‡ªåŠ¨ä¿å­˜åœ¨è¿™é‡Œ</div>
                    </div>
                </div>
            </div>
            
            <!-- æˆé•¿ä»ªè¡¨ç›˜åŒºåŸŸ -->
            <div id="growthDashboardTab" class="growth-content hidden">
                <div class="mb-6">
                    <h4 class="font-medium mb-3 text-gray-700">ğŸ’« èƒ½åŠ›é›·è¾¾å›¾</h4>
                    <div class="macaron-card blue relative">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm text-gray-600">äº”ä¸ªæ ¸å¿ƒè½¯æŠ€èƒ½ç»´åº¦åˆ†æ</div>
                            <div class="relative">
                                <button id="refreshRadarBtn" class="text-blue-500 hover:text-blue-700 text-sm px-3 py-1 border border-blue-300 rounded-full hover:bg-blue-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent">
                                    ğŸ”„ é‡æ–°åˆ†æ
                                </button>
                                <div id="refreshTooltip" class="absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 pointer-events-none transition-opacity duration-200 whitespace-nowrap z-10">
                                    <div class="absolute top-full right-3 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"></div>
                                    <span id="tooltipText">æç¤ºä¿¡æ¯</span>
                                </div>
                            </div>
                        </div>
                        <div class="h-80 flex items-center justify-center">
                            <canvas id="competencyRadarChart" class="radar-chart-canvas" width="300" height="300"></canvas>
                        </div>
                        <div id="radarPlaceholder" class="text-center hidden">
                            <div class="text-4xl mb-3">ğŸ“Š</div>
                            <div class="text-lg mb-1">æ•°æ®æ”¶é›†ä¸­</div>
                            <div class="text-sm text-gray-500">è¯·å…ˆè¿›è¡Œå¯¹è¯å’Œå¤ç›˜ï¼Œç³»ç»Ÿå°†åˆ†ææ‚¨çš„èƒ½åŠ›å‘å±•</div>
                        </div>
                    </div>
                </div>
                
                <!-- èƒ½åŠ›è¯¦æƒ…å±•ç¤ºåŒºåŸŸ -->
                <div id="competencyDetailSection" class="mb-6 hidden">
                    <div class="macaron-card purple">
                        <div class="flex items-center justify-between mb-4">
                            <h5 id="competencyDetailTitle" class="font-semibold text-lg">èƒ½åŠ›è¯¦æƒ…</h5>
                            <button id="closeDetailBtn" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
                        </div>
                        <div id="competencyDetailContent" class="space-y-4">
                            <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œå¡«å…… -->
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium mb-3 text-gray-700">é«˜é¢‘æŒ‘æˆ˜</h4>
                        <div class="macaron-card pink">
                            <div id="challengesList" class="text-center text-gray-600 py-4">
                                <div class="text-3xl mb-2">ğŸ¯</div>
                                <div>æš‚æ— æ•°æ®ï¼Œç»§ç»­å¯¹è¯å’Œå¤ç›˜</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-3 text-gray-700">æƒ…ç»ªæ¨¡å¼</h4>
                        <div class="macaron-card purple">
                            <div id="emotionPatterns" class="text-center text-gray-600 py-4">
                                <div class="text-3xl mb-2">ğŸ’­</div>
                                <div>æš‚æ— æ•°æ®ï¼Œç»§ç»­å¯¹è¯å’Œå¤ç›˜</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-3 text-gray-700">è¿›æ­¥å¯¹æ¯”</h4>
                        <div class="macaron-card green">
                            <div id="progressComparison" class="text-center text-gray-600 py-4">
                                <div class="text-3xl mb-2">ğŸ“ˆ</div>
                                <div>æš‚æ— æ•°æ®ï¼Œç»§ç»­å¯¹è¯å’Œå¤ç›˜</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-3 text-gray-700">è¡ŒåŠ¨åŠ›</h4>
                        <div class="macaron-card orange">
                            <div id="actionPower" class="text-center text-gray-600 py-4">
                                <div class="text-3xl mb-2">âš¡</div>
                                <div>æš‚æ— æ•°æ®ï¼Œç»§ç»­å¯¹è¯å’Œå¤ç›˜</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æœˆåº¦æŠ¥å‘ŠåŒºåŸŸ -->
            <div id="monthlyReportTab" class="growth-content hidden">
                <!-- æŠ¥å‘Šå¤´éƒ¨æ§åˆ¶åŒº -->
                <div class="mb-6 flex justify-between items-center">
                    <h4 class="font-medium text-xl">ğŸ“„ æœˆåº¦æˆé•¿æŠ¥å‘Š</h4>
                    <div class="flex items-center space-x-3">
                        <select id="monthSelector" class="text-sm border border-gray-300 rounded-md px-3 py-2">
                        <option value="current">æœ¬æœˆ</option>
                        <option value="last">ä¸Šæœˆ</option>
                    </select>
                        <button id="generateReportBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                            ğŸ”„ ç”ŸæˆæŠ¥å‘Š
                        </button>
                    </div>
                </div>
                
                <!-- æœˆåº¦æŠ¥å‘Šä¸»å†…å®¹åŒº -->
                <div id="monthlyReportContent" class="space-y-6">
                    <!-- é»˜è®¤çŠ¶æ€ -->
                    <div id="reportEmptyState" class="bg-white border border-gray-200 rounded-lg p-8">
                        <div class="text-center text-gray-500">
                            <div class="text-4xl mb-3">ğŸ“…</div>
                            <div class="text-lg mb-2">å‡†å¤‡ç”Ÿæˆæ‚¨çš„æˆé•¿æœˆæŠ¥</div>
                            <div class="text-sm">ç‚¹å‡»ä¸Šæ–¹çš„"ç”ŸæˆæŠ¥å‘Š"æŒ‰é’®å¼€å§‹</div>
                        </div>
                    </div>
                    
                    <!-- æŠ¥å‘Šå†…å®¹åŒºåŸŸ -->
                    <div id="reportContentArea" class="hidden">
                        <!-- â‘  æœ¬æœˆé«˜å…‰æ•°æ® -->
                        <div class="macaron-card blue">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="text-2xl mr-2">âœ¨</span>
                                æœ¬æœˆé«˜å…‰æ•°æ®
                            </h3>
                            <div id="topLineStats" class="space-y-4">
                                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œå¡«å…… -->
                            </div>
                        </div>
                        
                        <!-- â‘¡ æˆé•¿æ ‘å¿«ç…§ -->
                        <div class="macaron-card green">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="text-2xl mr-2">ğŸŒ±</span>
                                æˆé•¿æ ‘å¿«ç…§
                            </h3>
                            <div id="growthTreeSnapshot" class="space-y-4">
                                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œå¡«å…… -->
                            </div>
                        </div>
                        
                        <!-- â‘¢ è®¤çŸ¥çªç ´æ—¶åˆ» -->
                        <div class="macaron-card purple">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="text-2xl mr-2">ğŸ’¡</span>
                                è®¤çŸ¥çªç ´æ—¶åˆ»
                            </h3>
                            <div id="cognitiveBreakthroughs" class="space-y-4">
                                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œå¡«å…… -->
                            </div>
                        </div>
                        
                        <!-- â‘£ AIä¼™ä¼´å¯„è¯­ -->
                        <div class="macaron-card orange">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="text-2xl mr-2">ğŸ¤–</span>
                                AIä¼™ä¼´å¯„è¯­
                            </h3>
                            <div id="aiPartnerMessages" class="space-y-4">
                                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œå¡«å…… -->
                            </div>
                        </div>
                        
                        <!-- â‘¤ æˆå°±ä¸å¾½ç«  -->
                        <div class="macaron-card pink">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="text-2xl mr-2">ğŸ†</span>
                                æˆå°±ä¸å¾½ç« 
                            </h3>
                            <div id="achievementsAndBadges" class="space-y-4">
                                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œå¡«å…… -->
                            </div>
                        </div>
                        
                        <!-- è®¾å®šä¸‹æœˆç„¦ç‚¹ -->
                        <div class="macaron-card yellow">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <span class="text-2xl mr-2">ğŸ¯</span>
                                è®¾å®šä¸‹æœˆç„¦ç‚¹
                            </h3>
                            <div id="nextMonthFocus" class="space-y-4">
                                <p class="text-gray-600 text-sm mb-3">æ ¹æ®æœ¬æœˆæ´å¯Ÿï¼Œé€‰æ‹©1-2ä¸ªä¸‹æœˆå¸Œæœ›å…³æ³¨çš„æˆé•¿é¢†åŸŸï¼š</p>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="checkbox" name="nextFocus" value="è¡¨è¾¾åŠ›" class="mr-2 text-blue-500">
                                        <span class="text-sm">æå‡è¡¨è¾¾åŠ›</span>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="checkbox" name="nextFocus" value="å†³ç­–æ•ˆç‡" class="mr-2 text-blue-500">
                                        <span class="text-sm">æå‡å†³ç­–æ•ˆç‡</span>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="checkbox" name="nextFocus" value="æƒ…ç»ªç®¡ç†" class="mr-2 text-blue-500">
                                        <span class="text-sm">åŠ å¼ºæƒ…ç»ªç®¡ç†</span>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="checkbox" name="nextFocus" value="æ‰§è¡ŒåŠ›" class="mr-2 text-blue-500">
                                        <span class="text-sm">æå‡æ‰§è¡ŒåŠ›</span>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="checkbox" name="nextFocus" value="è¾¹ç•Œæ„Ÿ" class="mr-2 text-blue-500">
                                        <span class="text-sm">å»ºç«‹æ¸…æ™°è¾¹ç•Œ</span>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                        <input type="checkbox" name="nextFocus" value="å‘ä¸Šç®¡ç†" class="mr-2 text-blue-500">
                                        <span class="text-sm">ä¼˜åŒ–å‘ä¸Šç®¡ç†</span>
                                    </label>
                                </div>
                                <button id="saveNextFocusBtn" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                                    ä¿å­˜ä¸‹æœˆç„¦ç‚¹
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æŠ¥å‘Šæ“ä½œåŒº -->
                <div id="reportActions" class="mt-6 flex justify-between items-center hidden">
                    <div class="flex space-x-3">
                        <button id="shareReportBtn" class="px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg hover:from-green-600 hover:to-blue-600 flex items-center text-sm font-medium shadow-lg transform hover:scale-105 transition-all duration-200">
                            <span class="mr-2">ğŸ“¤</span>
                            ç”Ÿæˆåˆ†äº«é•¿å›¾
                        </button>
                    </div>
                    <div class="text-xs text-gray-500">
                        æŠ¥å‘Šç”Ÿæˆäº <span id="reportGeneratedTime"></span>
                    </div>
                </div>
            </div>

            <div class="flex justify-end mt-6">
                <button id="closeGrowthLog" class="py-2 px-4 bg-warm-blue text-white rounded-lg hover:bg-blue-600">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // ä¸ªäººä¸­å¿ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('profileBtn').addEventListener('click', function() {
            window.location.href = 'profile.html';
        });
        
        // é€€å‡ºç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            try {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include' // åŒ…å«Cookie
                });
                
                // é‡å®šå‘åˆ°ç™»å½•é¡µé¢
                window.location.href = 'login.html';
            } catch (error) {
                console.error('é€€å‡ºç™»å½•æ—¶å‡ºé”™:', error);
                alert('é€€å‡ºç™»å½•å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
            }
        });
    </script>
</body>
</html>